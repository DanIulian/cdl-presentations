% vim: set tw=78 aw sw=2 sts=2 noet:
\documentclass{beamer}

%\includeonlyframes{c} -- speeding up compilation speed during debug

\usepackage[utf8x]{inputenc} % diacritice
\usepackage[romanian]{babel}
\usepackage{hyperref}        % folositi \url{http://...}
\mode<presentation>
\usetheme{CDL}

\title[]{Git}
\subtitle{CDL 2011 - Cursul 3}
\institute[]{ROSEdu}
\author[]{Mihai Maruseac \\ \texttt{mihai@rosedu.org}}

\setbeamertemplate{frametitle continuation}[from second]
\setbeamertemplate{footline}[frame number]

%\pgfdeclareimage[height=5cm]{m0}{img/m0}
%\pgfdeclareimage[height=7cm]{m1}{img/m1}
%\pgfdeclareimage[height=7cm]{m2}{img/m2}
%\pgfdeclareimage[height=7cm]{m3}{img/m3}

\begin{document}

\maketitle

\section{Source Control Management}

\begin{frame}{Intro}
  \begin{alertblock}{Quote}
    \texttt{\textit{Perilous to us all are the devices of an art deeper than
    we posses ourselves.}}
    \flushright{(Tolkien)}
  \end{alertblock}
  \pause
  \begin{alertblock}{Quote}
    \texttt{\textit{Keep your code safe. Tattoo that sentence backward across
    your forehead and stare in the mirror for 10 minutes every morning.}}
    \flushright{(adapted from Pete Goodliffe)}
  \end{alertblock}
\end{frame}

\begin{frame}{Source Control Management}
  \begin{itemize}[<+->]
    \item aka Revision Control
    \item urmărire/stocare modificări
      \begin{alertblock}{Careful!}
        NU copy-paste în directoare separate
      \end{alertblock}
    \item colaborare, proiecte mari
      \begin{alertblock}{Careful!}
        NU mail / dropbox
      \end{alertblock}
  \end{itemize}
\end{frame}

\begin{frame}{Concepte}
  \begin{description}[<+->]
    \item[repository] = ...
    \item[checkout,clone] = make local copy
    \item[working copy] = copie locală, \textbf{sandbox}
    \item[change] = modificare
    \item[commit] = submit changes
    \item[update] = sync
    \item[merge] = aplicare a 2+ commits
    \item[conflict] = schimbări în același document
    \item[version] = revision
    \item[HEAD] = cel mai recent commit (tip)
    \item[branch] = alternativă development
    \item[label] = punct important din development (tag)
  \end{description}
\end{frame}

\begin{frame}{Unde e repository-ul?}
  \begin{itemize}
    \item centralizat
      \begin{itemize}
        \item server: DB
        \item client: working copy
      \end{itemize}
      \pause
      \begin{description}
        \item[+] totul la un loc
        \item[--] bottleneck, \textit{single point of failure}
      \end{description}
    \pause
    \item descentralizat
      \begin{itemize}
        \item P2P
        \item operații/concepte noi
        \item repo si working-tree simultan
        \item istoric si lucru complet descentralizat
      \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}{SCM Descentralizat}
  \begin{itemize}
    \item avantaje
      \begin{itemize}
        \item fără \textit{single point of failure}
        \item lucru deconectat
        \item operații rapide
        \item modele noi de development
      \end{itemize}
    \pause
    \item dezavantaje
      \begin{itemize}
        \item mai greu de înteles
        \item cine are acces?
        \item istoria e permanentă (almost)
      \end{itemize}
    \pause
    \item operatii noi
      \begin{description}[<+->]
        \item[push] - sync eu $\rightarrow$ remote
        \item[fetch,pull] - sync eu $\leftarrow$ remote
        \item[remote] - ...
      \end{description}
  \end{itemize}
\end{frame}

\begin{frame}{SCMs}
  \begin{itemize}
    \item \textbf{SVN} (Subversion), centralizat, C
    \item \textbf{Git} descentralizat, Perl, C, shell
    \item \textbf{Mercurial} descentralizat, $<$ Git (see wiki ref), Python, C, shell
    \item \textbf{darcs} patch (see Darcs ref), Haskell, lazy
  \end{itemize}
  \pause
  \begin{alertblock}{Hint}
    Toate sunt folosite. Încercați-le și voi :)
  \end{alertblock}
\end{frame}

\section{Git}

\begin{frame}{Git history}
  \begin{itemize}
    \item Linus Torvalds
    \item Linux Kernel (moved from BitKeeper)
    \item design:
      \begin{itemize}
        \item \textit{CVS as example of what \textbf{not} to do}
        \item distribuit, workflow a la BitKeeper
        \item protecție contra distrugerilor/erorilor
        \item perfomanță
      \end{itemize}
    \item development start: 3 aprilie 2005
    \item 29 aprilie 2005: 6.7 patch-uri/s în kernel via Git
    \item 16 iunie 2005: 2.6.12 pe Git
    \item 31 ianuarie 2011: git 1.7.4
    \item C, Perl, shell
  \end{itemize}
\end{frame}

\begin{frame}{Git mits}
  \begin{itemize}[<+->]
    \item git is hard to learn
    \item git is slow
    \item git nu e matur
    \item nimeni nu folosește git
    \item proiectele care folosesc git au un SVN in spate
    \item nu poti muta proiecte de pe SVN pe Git
  \end{itemize}
\end{frame}

\begin{frame}{Git metadata}
  \begin{itemize}[<+->]
    \item director \texttt{.git} \textit{doar} în rădăcină
    \item conținut:
      \begin{itemize}
        \item \texttt{.git/config} fișier configurare
        \item \texttt{.git/hooks} scripturi pentru evenimente
        \item \texttt{.git/refs} referințe (la ce?)
      \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}{Git config}
  \begin{itemize}
    \item local în \texttt{.git/config}
    \item global în \texttt{\$HOME/.gitconfig}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 1}
    \begin{itemize}
      \item install git
      \item \texttt{git config --global user.name "\textit{nume prenume}"}
      \item \texttt{git config --global user.email "\textit{nume@dom.com}"}
      \item \texttt{git config --global color.ui auto}
      \item \texttt{git config --global color.pager true}
      \item \texttt{git config --global core.editor \textit{editor}}
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Git commands}
  \begin{itemize}
    \item \texttt{git \textit{cmd args}}
    \item \texttt{git help}
    \item \texttt{git help \textit{cmd}}
    \item \texttt{git \textit{cmd} help}
    \item \texttt{man git-\texttt{cmd}}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 2}
    \begin{itemize}
      \item Ce reprezenta opțiunea \texttt{color.pager} de la \texttt{git config}?
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Primul repo}
  \begin{itemize}
    \item \texttt{git init} într-un director cu surse
    \item \texttt{git clone \textit{url}}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 3}
    \begin{itemize}
      \item Obțineți repository-ul de la adresa TODO
      \item listați conținutul directorului creat
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}[label=Content]{Conținut}
  \begin{alertblock}{Careful!}
    Git urmărește conținut, nu fișiere!!
  \end{alertblock}
  \begin{itemize}
    \item work tree (working dir): local
    \item index: pregătit de commit
    \item repository: commit salvat
  \end{itemize}
\end{frame}

\begin{frame}{Staging}
  \begin{itemize}
    \item work tree $\rightarrow$ index
    \item \texttt{git add \textit{filename}}
    \item \texttt{git rm \textit{filename}}
    \item \texttt{git mv \textit{filename}}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 4}
    \begin{itemize}
      \item Modificați sursa TODO din director, adăugând numele vostru pe linia
      corespunzătoare.
      \item Mutați în index fișierul modificat
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Commiting}
  \begin{itemize}
    \item index $\rightarrow$ repository \textbf{local}
    \item \texttt{git commit \textbf{-m "\textit{mesaj}"}}
  \end{itemize}
  \begin{alertblock}{Careful!}
    Nu folosiți mesaje goale!
  \end{alertblock}
\end{frame}

\begin{frame}{Shortcuts}
  \begin{itemize}
    \item \texttt{git commit -am "..."}
    \item \texttt{git add .}
    \pause
    \begin{alertblock}{Tip}
      Nu rulați \texttt{git commit -am..}.
    \end{alertblock}
    \begin{alertblock}{Careful!}
      Nu rulați \texttt{git add .} dacă nu aveți totul setat ok.
    \end{alertblock}
    \pause
    \item probleme:
      \begin{itemize}
        \item fișiere executabile (\texttt{a.out}), obiect (\texttt{a.o})
        \item fișiere swap (\texttt{.git.tex.swp})
        \item fișiere locale, personale
        \item etc.
      \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}{Ignore}
  \begin{itemize}
    \item \texttt{.gitignore} - \textbf{global!!}
    \item \texttt{.git/info/exclude} - local
  \end{itemize}
  \pause
  \begin{alertblock}{Task 5}
    \begin{itemize}
      \item Ignorați \textbf{local} fișierele obiect și executabilul generat.
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Commit (2)}
  \begin{itemize}
    \item fiecare commit are un ID: SHA1
    \item fiecare commit are cel puțin un părinte (cu excepția primului)
    \item graf aciclic de commit-uri
    \pause
    \item undo: \texttt{git reset}
    \item type: \texttt{git commit -amend}
    \item revenire la un working tree anterior: \texttt{git revert \textit{id}}
    (nerecomandat)
    \item doar pt un fișier: \texttt{git checkout \textit{file}}
    \pause
    \item cum referim un commit?
  \end{itemize}
\end{frame}

\begin{frame}{Commit (3)}
  \begin{description}
    \item[\texttt{HEAD}] = ultimul commit
    \item[\texttt{HEAD\textasciicircum}] = penultimul
    \item[\texttt{HEAD\textasciicircum\textasciicircum}] = antepenultimul
    \item[...] = etc
    \pause
    \item[\texttt{HEAD\textasciitilde5}] = \texttt{HEAD\textasciicircum\textasciicircum\textasciicircum\textasciicircum\textasciicircum}
    \pause
    \item[a946e644d5b4c26aaa4e73338805e207bbfd78b0] = full hash
    \pause
    \item[a946e6] = short hash
  \end{description}
\end{frame}

\begin{frame}{Status}
  \begin{itemize}
    \item \texttt{git status}
    \item prezintă:
      \begin{itemize}
        \item conținut din index {staged}
        \item conținut care nu e în index {non-staged}
        \item conținut neurmărit (non-tracked)
        \item other info
      \end{itemize}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 6}
    \begin{itemize}
      \item Modificați sursa TODO, adăugând numele și grupa pe linia
      corespunzătoare.
      \item creați un fișier numit după voi în working dir
      \item vizualizați starea working dir.
      \item faceți working dir clean
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Diff}
  \begin{itemize}
    \item \texttt{git diff} - diferențe index - working tree
    \item \texttt{git diff --cached} - conținut index
    \item \texttt{git diff \textit{idcommit1}} - commit și working dir
    \item \texttt{git diff \textit{idcommit1} \textit{idcommit2}} - commit și
    commit
  \end{itemize}
  \pause
  \begin{alertblock}{Task 7}
    \begin{itemize}
      \item obtineți un diff între HEAD și starea inițială a repo-ului
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Remote Repository}
  \begin{itemize}
    \item clone = copie repo remote
    \item commit /= update goes to repo
    \item \texttt{git push origin master} - trimite commit-urile în branch-ul
    master din repository-ul referit de origin
    \item dacă nu pot exista confuzii, merge și \texttt{git push}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 8}
    \begin{itemize}
      \item Transmiteți commit-urile voastre repository-ului central (de unde
      ați clonat).
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Remote Repository(2)}
  \begin{itemize}
    \item \texttt{git pull}
    \item \texttt{git fetch ...}
    \item obțin commit de la un remote
    \item actualizează repository-ul local
  \end{itemize}
  \pause
  \begin{alertblock}{Task 9}
    \begin{itemize}
      \item Actualizați repository-ul local cu cel remote.
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Remote Repository(3)}
  \begin{itemize}
    \item cum adăugăm un alt remote?
    \item \texttt{git remote add \textit{nume} \textit{url}}
    \pause
    \item cum vedem ce remote-uri există?
    \item \texttt{git remote show}
  \end{itemize}
\end{frame}

\begin{frame}{Branches}
  \begin{itemize}[<+->]
    \item \texttt{git push origin master} - trimite commit-urile în branch-ul
    master din repository-ul referit de origin
    \item ramuri de dezvoltare
    \item locale: \texttt{git branch}
    \item remote: \texttt{git branch -r}
    \item toate: \texttt{git branch -a}
    \item *\textit{numebranch}: branch curent
  \end{itemize}
  \pause
  \begin{alertblock}{Task 10}
    \begin{itemize}
      \item Listați \textbf{toate} branch-urile din repository.
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Branches (2)}
  \begin{itemize}
    \item creare:
      \begin{itemize}
        \item \texttt{git branch \textit{nume} \textit{startref}}
        \item \texttt{git branch \textit{nume}}
        \item \texttt{git checkout -b \textit{nume}}
      \end{itemize}
    \pause
    \item ștergere:
      \begin{itemize}
        \item \texttt{git branch -d \textit{bname}}
        \item \texttt{git branch -D \textit{bname}}
      \end{itemize}
    \pause
    \item schimbare branch:
      \begin{itemize}
        \item \texttt{git checkout \textit{bname}}
      \end{itemize}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 11}
    \begin{itemize}
      \item Schimbați în branch-ul corespunzător numelui vostru.
      \item Listați conținutul directorului
      \item Ce s-a întâmplat cu sursele vechi?
    \end{itemize}
  \end{alertblock}
\end{frame}

\againframe{Content}

\begin{frame}{Branches (3)}
  \begin{alertblock}{Task 12}
    \begin{itemize}
      \item Rezolvați TODO-ul din fișierul existent și faceți commit și push
      \item reveniți în branch-ul master și faceți pull (folosiți argumentul
      --all)
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Best Practices}
  \begin{itemize}
    \item repository: mereu compilabil
    \item mesaje de commit relevante
    \item commit-uri mici: un singur bugfix/feature/patch
  \end{itemize}
\end{frame}

\section{More git}

\begin{frame}{Log}
  \begin{itemize}
    \item istoria din repo
    \item \texttt{git log}: toată istoria
    \item \texttt{git log \textit{ref1}..\textit{ref2}}: între refs
    \item \texttt{git log \textit{file}}: doar file
  \end{itemize}
\end{frame}

\begin{frame}{Tools}
  \begin{itemize}
    \item repo-git human read-able
    \begin{itemize}
      \item gitk - Tcl/Tk, cel mai cunoscut
      \item giggle - Gnome, GTK+
      \item tig - command line
    \end{itemize}
  \end{itemize}
  \begin{alertblock}{Hint}
    Toate sunt folosite. Încercați-le și voi :)
  \end{alertblock}
\end{frame}

\begin{frame}{Tools(2)}
  \begin{alertblock}{Task 13}
    \begin{itemize}
      \item Instalați gitk și vizualizați starea repo-ului
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Merge vs Rebase}
  \begin{itemize}
    \item Ce se întâmplă la pull când avem și local commit-uri noi?
    \pause
    \item merge - combină commit-urile
    \item rebase - reordonează istoria
  \end{itemize}
  \pause
  \begin{alertblock}{Task 14}
    \begin{itemize}
      \item TODO
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{Tags}
  \begin{itemize}
    \item momente importante din development (release, etc)
    \item creat cu \texttt{git tag \textit{nume} \textit{ref}}
    \item șters cu \texttt{git tag -d \textit{nume}}
    \item Putem referi commit-uri cu tag-uri prin numele tagurilor
  \end{itemize}
  \pause
  \begin{alertblock}{Task 15}
    \begin{itemize}
      \item TODO
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}[label=l]{Links}
  \begin{itemize}
    \item \href{http://en.wikipedia.org/wiki/Comparison_of_revision_control_software}{Comparație între SCM-uri}
    \item \href{http://en.wikibooks.org/wiki/Understanding_Darcs/Patch_theory}{Darcs Patch Theory}
    \item \href{http://talks.rosedu.org/prezentari/prezentarea03}{Prezentare
    Tech Talks Git (Mircea Bardac)}
    \item \href{http://github.com}{GitHub}
    \item
    \href{http://www.eqqon.com/index.php/Collaborative_Github_Workflow}{Workflof
    GitHub}
  \end{itemize}
\end{frame}

\section{Extra git}

\begin{frame}{Git bisect}
  \begin{itemize}
    \item identifică commit-ul care a introdus un bug
    \item \texttt{git bisect start}
    \item \texttt{git bisect bad}
    \item \texttt{git bisect good \textit{commit\_ok}}
    \item view, test, repeat
    \pause
    \item \texttt{git blame}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 16}
    \begin{itemize}
      \item TODO
    \end{itemize}
  \end{alertblock}
\end{frame}

\begin{frame}{GitHub}
  \begin{itemize}
    \item web-based repo for git
    \item repos și gists
    \item pages
    \pause
    \item 1. fork
    \item 2. clone your own repo
    \item 3. commit early and often
    \item 4. fork queue / pull requests
    \item 5. repeat / profit :D
  \end{itemize}
\end{frame}

\section{Even more extra git}

\begin{frame}{Cherry pick}
  \begin{itemize}
    \item cod dintr-un branch în altul
    \item util când branch-urile diverg foarte tare
    \item se `culeg' commit-urile relevante
    \item \texttt{git cherry-pick \textit{IDcommit}}
  \end{itemize}
  \pause
  \begin{alertblock}{Task 17}
    \begin{itemize}
      \item TODO
    \end{itemize}
  \end{alertblock}
\end{frame}

\againframe{l}

%  \transwipe[direction=90,duration=2]
%  \begin{pgfpicture}{0cm}{0cm}{10cm}{5cm}
%    \pgfsetcolor{red}
%    \pgfrect[stroke]{\pgfpoint{3cm}{1cm}}{\pgfpoint{6cm}{1.5cm}}
%  \end{pgfpicture}
%  \pgfuseimage{m0}

\end{document}
